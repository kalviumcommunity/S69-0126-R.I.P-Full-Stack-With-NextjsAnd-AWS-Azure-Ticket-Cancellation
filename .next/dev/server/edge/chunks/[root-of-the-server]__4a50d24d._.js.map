{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'stream')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`stream`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'crypto')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`crypto`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"supersecretkey\";\r\n\r\ninterface DecodedToken {\r\n  id: number;\r\n  email: string;\r\n  role: \"admin\" | \"user\";\r\n}\r\n\r\nexport function middleware(req: NextRequest) {\r\n  const { pathname } = req.nextUrl;\r\n\r\n  // Only protect specific routes\r\n  if (pathname.startsWith(\"/api/admin\") || pathname.startsWith(\"/api/users\")) {\r\n    const authHeader = req.headers.get(\"authorization\");\r\n    const token = authHeader?.split(\" \")[1];\r\n\r\n    if (!token) {\r\n      return NextResponse.json(\r\n        { success: false, message: \"Token missing\" },\r\n        { status: 401 }\r\n      );\r\n    }\r\n\r\n    try {\r\n      const decoded = jwt.verify(token, JWT_SECRET) as DecodedToken;\r\n\r\n      // Role-based access control\r\n      if (pathname.startsWith(\"/api/admin\") && decoded.role !== \"admin\") {\r\n        return NextResponse.json(\r\n          { success: false, message: \"Access denied. Admin role required.\" },\r\n          { status: 403 }\r\n        );\r\n      }\r\n\r\n      // Attach user info for downstream handlers\r\n      const requestHeaders = new Headers(req.headers);\r\n      requestHeaders.set(\"x-user-id\", decoded.id.toString());\r\n      requestHeaders.set(\"x-user-email\", decoded.email);\r\n      requestHeaders.set(\"x-user-role\", decoded.role);\r\n\r\n      return NextResponse.next({ request: { headers: requestHeaders } });\r\n    } catch (error) {\r\n      return NextResponse.json(\r\n        { success: false, message: \"Invalid or expired token\" },\r\n        { status: 403 }\r\n      );\r\n    }\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\n// Configure which routes the middleware applies to\r\nexport const config = {\r\n  matcher: [\"/api/admin/:path*\", \"/api/users/:path*\"],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AAEA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAQtC,SAAS,WAAW,GAAgB;IACzC,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,OAAO;IAEhC,+BAA+B;IAC/B,IAAI,SAAS,UAAU,CAAC,iBAAiB,SAAS,UAAU,CAAC,eAAe;QAC1E,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;QACnC,MAAM,QAAQ,YAAY,MAAM,IAAI,CAAC,EAAE;QAEvC,IAAI,CAAC,OAAO;YACV,OAAO,gMAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAAgB,GAC3C;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI;YACF,MAAM,UAAU,wJAAG,CAAC,MAAM,CAAC,OAAO;YAElC,4BAA4B;YAC5B,IAAI,SAAS,UAAU,CAAC,iBAAiB,QAAQ,IAAI,KAAK,SAAS;gBACjE,OAAO,gMAAY,CAAC,IAAI,CACtB;oBAAE,SAAS;oBAAO,SAAS;gBAAsC,GACjE;oBAAE,QAAQ;gBAAI;YAElB;YAEA,2CAA2C;YAC3C,MAAM,iBAAiB,IAAI,QAAQ,IAAI,OAAO;YAC9C,eAAe,GAAG,CAAC,aAAa,QAAQ,EAAE,CAAC,QAAQ;YACnD,eAAe,GAAG,CAAC,gBAAgB,QAAQ,KAAK;YAChD,eAAe,GAAG,CAAC,eAAe,QAAQ,IAAI;YAE9C,OAAO,gMAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;oBAAE,SAAS;gBAAe;YAAE;QAClE,EAAE,OAAO,OAAO;YACd,OAAO,gMAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,SAAS;YAA2B,GACtD;gBAAE,QAAQ;YAAI;QAElB;IACF;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAGO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAqB;KAAoB;AACrD"}}]
}